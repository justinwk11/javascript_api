<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script type="text/javascript" src="lib/js/bs58.bundle.js"></script>
    <script type="text/javascript" src="lib/js/bip39.min.js"></script>
    <script type="text/javascript" src="lib/js/safe-buffer.bundle.js"></script>
    <script type="text/javascript" src="lib/js/networks.js"></script>
    <script type="text/javascript" src="lib/js/bitcoinjs.min.js"></script>
    <script type="text/javascript" src="lib/js/big-integer.min.js"></script>
    <script type="text/javascript" src="lib/js/index.js"></script>
    <script type="text/javascript" src="lib/js/bundle.js"></script>


    <h3>비밀번호 입력 방식</h3>
    <p>Password
        <input id="password" type="password">
        <button onclick="createKeypairswithpwdBtn()">createKeypairs</button>
    </p>
    <p id="compressedPubkeyPW"></p>
    <p id="uncompressedPubkeyPW"></p>
    <p id="encryptPrivkeyPW"></p>

    <p>개인키 복호화
        <button onclick="decryptPrivkeyBtn()">decryptPrivatekey</button></p>
    <p id="decryptPrivkeyPW"></p>

    <p>Message
        <input id="messagePW" type="text">
        <button onclick="signEncryptPrivatekey()">sign</button></p>
    <p id="signedDataPW"></p>

    <p>검증
        <button onclick="verifyEncryptedPrivatekey()">verify</button></p>
    <p id="verifyPW"></p>
    <hr>


    <h3>비밀번호 없이 진행</h3>
    <button onclick="createKeypairsBtn()">createKeypairs</button>
    <p id="compressedPubkey"></p>
    <p id="uncompressedPubkey"></p>
    <p id="privatekey"></p>

    <p>Message
        <input id="message" type="text">
        <button onclick="sign()">sign</button></p>
    <p id="signedData"></p>

    <p>검증
        <button onclick="verify()">verify</button></p>
    <p id="verify"></p>

</head>

<body>
    <script>

        function createKeypairswithpwdBtn() {
            var password = document.getElementById("password").value
            if (pwdCheck(password) == true) {
                let keyPairs = createEncryptKeypairs(password)
                document.getElementById("compressedPubkeyPW").innerHTML = "Compressed Public Key : " + keyPairs.compressedPubkey
                document.getElementById("uncompressedPubkeyPW").innerHTML = "Uncompressed Public Key : " + keyPairs.uncompressedPubkey
                module.encryptPrivatekey(keyPairs.privatekey, password).then((encryptPrivkey) => {
                    document.getElementById("encryptPrivkeyPW").innerHTML = "Encrypted Private Key : " + encryptPrivkey
                })
            }
        }

        function createKeypairsBtn() {
            let keyPairs = createKeypairs()
            document.getElementById("compressedPubkey").innerHTML = "Compressed Public Key : " + keyPairs.compressedPubkey
            document.getElementById("uncompressedPubkey").innerHTML = "Uncompressed Public Key : " + keyPairs.uncompressedPubkey
            document.getElementById("privatekey").innerHTML = "Private Key : " + keyPairs.privatekey
        }

        function decryptPrivkeyBtn() {
            let encryptPrivkey = document.getElementById("encryptPrivkeyPW").innerHTML
            encryptPrivkey = encryptPrivkey.slice(24)
            let password = document.getElementById("password").value
            if (pwdCheck(password) == true) {
                module.decryptPrivatekey(encryptPrivkey, password).then((decryptedPrivkey) => {
                    document.getElementById("decryptPrivkeyPW").innerHTML = "Decrypted Private Key : " + decryptedPrivkey
                })
            }
        }

        function signEncryptPrivatekey() {
            let password = document.getElementById("password").value
            if (pwdCheck(password) == true) {
                let encryptPrivkey = document.getElementById("encryptPrivkeyPW").innerHTML
                encryptPrivkey = encryptPrivkey.slice(24)
                let message = document.getElementById("messagePW").value
		        if(msgCheck(message) == true) {
                    module.decryptPrivatekey(encryptPrivkey, password).then((decryptedPrivkey) => {
                        let privatekey = decryptedPrivkey
                        module.sign(privatekey, message).then((signedData) => {
                            document.getElementById("signedDataPW").innerHTML = "Signed Data : " + signedData.toString('hex')
                        })
                    })
                }
            }
        }

        function sign() {
            let privatekey = document.getElementById("privatekey").innerHTML
            privatekey = privatekey.slice(14)
            let message = document.getElementById("message").value
            if(msgCheck(message) == true) {
                module.sign(privatekey, message).then((signedData) => {
                    document.getElementById("signedData").innerHTML = "Signed Data : " + signedData.toString('hex')
                })
            } 
        }

        function verifyEncryptedPrivatekey() {
            let uncompressedPubkey = document.getElementById("uncompressedPubkeyPW").innerHTML
            uncompressedPubkey = uncompressedPubkey.slice(26)
            let message = document.getElementById("messagePW").value
            if(msgCheck(message) == true) {
                let signedData = document.getElementById("signedDataPW").innerHTML
                signedData = signedData.slice(14)
                module.verify(uncompressedPubkey, message, signedData).then((result) => {
                    document.getElementById("verifyPW").innerHTML = result
                })
            } 
        }

        function verify() {
            let uncompressedPubkey = document.getElementById("uncompressedPubkey").innerHTML
            uncompressedPubkey = uncompressedPubkey.slice(26)
            let message = document.getElementById("message").value
            if(msgCheck(message) == true) {
                let signedData = document.getElementById("signedData").innerHTML
                signedData = signedData.slice(14)
                module.verify(uncompressedPubkey, message, signedData).then((result) => {
                    document.getElementById("verify").innerHTML = result
                })
            }
        }

        function pwdCheck(password) {
            if (password != "")
                return true
            else
                alert("password isn't set")
        }

	    function msgCheck(message) {
	        if (message != "")
                return true
            else
                alert("message is at least more than a letter")
        }

    </script>
</body>

</html>
